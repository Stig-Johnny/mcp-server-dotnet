apiVersion: v1
kind: ConfigMap
metadata:
  name: github-runners-grafana-dashboard
  namespace: github-runners
  labels:
    app.kubernetes.io/name: github-runners-grafana-dashboard
    app.kubernetes.io/part-of: mcp-server-dotnet
    grafana_dashboard: "1"  # Label for Grafana sidecar to pick up
data:
  github-runners-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "GitHub Actions Runners - MCP Server .NET",
        "tags": ["github-actions", "runners", "mcp-server-dotnet"],
        "style": "dark",
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Active Runners",
            "type": "stat",
            "targets": [
              {
                "expr": "sum(github_runner_status{repository=\"Stig-Johnny/mcp-server-dotnet\"})",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {
                      "color": "red",
                      "value": 0
                    },
                    {
                      "color": "green",
                      "value": 1
                    }
                  ]
                }
              }
            },
            "gridPos": {
              "h": 8,
              "w": 12,
              "x": 0,
              "y": 0
            }
          },
          {
            "id": 2,
            "title": "Runner Jobs",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(github_runner_jobs_total{repository=\"Stig-Johnny/mcp-server-dotnet\"}[5m])",
                "refId": "A"
              }
            ],
            "gridPos": {
              "h": 8,
              "w": 12,
              "x": 12,
              "y": 0
            },
            "yAxes": [
              {
                "label": "Jobs per second",
                "show": true
              },
              {
                "show": true
              }
            ]
          },
          {
            "id": 3,
            "title": "Runner Resource Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(container_cpu_usage_seconds_total{namespace=\"github-runners\"}[5m])",
                "refId": "A",
                "legendFormat": "CPU Usage"
              },
              {
                "expr": "container_memory_usage_bytes{namespace=\"github-runners\"} / 1024 / 1024",
                "refId": "B",
                "legendFormat": "Memory Usage (MB)"
              }
            ],
            "gridPos": {
              "h": 8,
              "w": 24,
              "x": 0,
              "y": 8
            }
          },
          {
            "id": 4,
            "title": "Recent Workflow Runs",
            "type": "table",
            "targets": [
              {
                "expr": "github_runner_job_duration_seconds{repository=\"Stig-Johnny/mcp-server-dotnet\"}",
                "refId": "A"
              }
            ],
            "gridPos": {
              "h": 8,
              "w": 24,
              "x": 0,
              "y": 16
            }
          }
        ],
        "time": {
          "from": "now-1h",
          "to": "now"
        },
        "timepicker": {},
        "templating": {
          "list": []
        },
        "annotations": {
          "list": []
        },
        "refresh": "30s",
        "schemaVersion": 27,
        "version": 1,
        "links": []
      }
    }